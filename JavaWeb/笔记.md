# 互联网常见协议

​       **协议**         **工作端口**

- http           80         
- smtp         25
- pop3         110
- ftp              23
- https          443

# Tomcat启动失败原因

- JAVA_HOME环境未配置

由于Tomcat依赖于java环境，所以Tomcat找不到JDK环境，就启动不了Tomcat

- 端口被占用
- Catalina_home环境变量的设置问题

Catalina_home环境变量：配置Tomcat位置

startup.bat（启动Tomcat），首先会在环境变量中启动Catalina_home配置中的Tomcat。所以，如果你配置了Catalina_home的话，在本地盘中有多个Tomcat服务器，假若你运行的是C盘中的startup.bat，但你Catalina_home配的是D盘的Tomcat，则它启动的D盘的Tomcat。



# Tomcat目录结构

- bin                            存放启动和关闭Tomcat等的脚本文件
- conf                          存放Tomcat的各种配置文件(如配置Tomcat运行端口的server.xml文件)
- lib                              存放Tomcat支持的jar包
- logs                           存放Tomcat的日志文件（如Tomcat黑窗口中的输出信息）
- temp                         存放Tomcat运行是产生的临时文件。对于WEB开发者来说不必关心，只供Tomcat服务器开发者有用
- webapps                  存放Web开发的应用，即供外界访问的Web资源存放目录
- work                         Tomcat的工作目录，如Tomcat在运行中将JSP转换成Servlet代码，这些Servlet代码就存放在工作目录中



# WEB应用的组成结构

- mail					WEB应用所在目录
- html,jsp,css,js文件等            这些文件一般存在WEB应用根目录下，根目录下的文件外界可以直接访问
- WEB-INF                                java类，jar包，web应用的配置文件存在这个目录下，该目录下的文件外界无法直接访问，有web服务器负责调用
- WEB-INF/classes                  java类
- WEB-INF/lib                          jar包
- WEB-INF/web.xml               WEB应用配置文件

# 虚拟目录的映射

**WEB应用:**  WEB应用程序指供浏览器访问的程序，通常称为WEB应用

**WEB目录：**存放WEB应用程序的目录，称之为WEB目录

**虚拟目录的映射:** WEB应用开发好后，若想供外界访问，需要将WEB目录交给WEB服务器管理，这个过程称之为虚拟目录的映射。



### 虚拟目录映射方式

- 在conf\server.xml目录下配置<Context/>

```
<Context path="/外界访问的虚拟目录"  docBase="WEB目录"/>
```

**特点**：加入WEB服务器（Tomcat）在C盘，而开发的工作环境目录在D盘，那么就可以通过这种方式，直接将D盘的WEB应用目录映射到Tomcat中。**但需要重启Tomcat。**

- 在conf\Catalina\localhost下创建**文件名.XML**，在XML文件下配置<Context/>

1. 文件名：外界访问的虚拟目录
2. 文件下配置

**技巧：**如果需要进行多级的虚拟目录（即：localhost:8080**/a/b/c**）,那么可通过取文件名的时候在每级目录名用”#“进行分割

如：创建一个多级目录localhost:8080**/a/b/c**，则文件名就是：a#b#c.xml

**特点**：加入WEB服务器（Tomcat）在C盘，而开发的工作环境目录在D盘，那么就可以通过这种方式，直接将D盘的WEB应用目录映射到Tomcat中。**无需重启Tomcat。**

```
<Context docBase="WEB目录"/>
```

- 直接将WEB应用放在webapps下，Tomcat会自动映射

**特点**：**方便快捷。无需重启Tomcat。**但会只能跟随Tomcat服务器目录，所以如果Tomcat放在C盘，则会消耗C盘空间。



# 配置虚拟主机

### 简介

在一个tomcat服务器中可以放置多个网站，所谓配置虚拟主机，就是在tomcat服务器中放置一个网站

### 方法

使用服务器配置文件（server.xml）中用户Host元素标签进行配置。

```
<Host name="主机名" appBase="站点目录"/>
```

配置完虚拟主机之后在配置该站点的WEB应用。

```
<Host name="主机名" appBase="站点目录">
<Context path="虚拟目录" docBase="WEB应用实际目录" />
<Host/>
```



# 浏览器访问Web资源的流程

![浏览器访问Web资源的流程图](E:\笔记\JavaWeb\photo\浏览器访问Web资源的流程图.png)

### 主机名作用

1. 通过主机名搜索DNS服务器查找服务器IP
2. 在发送HTTP请求中携带主机名，确定访问的站点



# WEB应用打包

### 命令

```
jar -cvf 包名.war WEB应用目录
```

###jar命令参数

![jar参数](E:\笔记\JavaWeb\photo\jar参数.bmp)

### 打包

![WEB应用打包](E:\笔记\JavaWeb\photo\WEB应用打包.bmp)

将war包直接放在tomcat的默认虚拟主机目录（webapps）下，tomcat会自动识别解压.

# Tomcat体系架构

1. Tomcat启动时会启动一个Service（服务）

2. 这个服务会启动多个Connector(连接器),不同连接器处理不同请求。如处理HTTP，HTTPS（加密请求）。。。

3. 连接器处理请求时会找Tomcat引擎（Engine）

4. Engine会找请求的虚拟主机目录

5. 虚拟主机就找请求的WEB应用

6. WEB应用找到请求对应的WEB资源

   ![img](file:///E:/%E7%AC%94%E8%AE%B0/JavaWeb/photo/Tomcat%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84.bmp?lastModify=1524404941)

# 配置加密连接器

- 创建数字证书

​       **Java命令**

```
keytool -genkey -alias tomcat -keyalg RSA
```

![创建数字证书](E:\笔记\JavaWeb\photo\创建数字证书.bmp)

- 在server.xml配置加密连接器

```
    <Connector port="8443" protocol="org.apache.coyote.http11.Http11Protocol"
maxThreads="150" SSLEnabled="true" scheme="https" secure="true"
clientAuth="false" sslProtocol="TLS" 
keystoreFile="conf/.keystore"     //数字证书目录
keystorePass="数字证书密钥库密码"  
    />

```

- 通过HTTPS连接器访问WEB应用

![用加密连接器访问WEB应用](E:\笔记\JavaWeb\photo\用加密连接器访问WEB应用.bmp)